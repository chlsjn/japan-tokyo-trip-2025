<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <!-- åŠ å…¥ viewport-fit=cover ä»¥é©æ‡‰ iPhone ç€æµ·å…¨è¢å¹• -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ—¥æœ¬æ±äº¬è¼•äº•æ¾¤ä¸ƒæ—¥æ—…ç¨‹</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <!-- iOS ä¸»ç•«é¢åœ–ç¤º (è«‹ç¢ºä¿ GitHub ä¸Šæœ‰ icon03.png é€™å€‹æª”æ¡ˆ) -->
    <link rel="apple-touch-icon" href="icon03.png">
    
    <!-- é–‹å•Ÿ Web App æ¨¡å¼ -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="æ±äº¬ä¹‹æ—…">

    <style>
        :root {
            --color-primary: #1F2937;
            --color-bg-light: #F7F8FC;
            --color-bg-card: #FFFFFF;
            --color-border: #E5E7EB;
        }

        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: var(--color-bg-light);
            /* é‡å° iOS PWA æ¨¡å¼å¢åŠ é ‚éƒ¨é–“è·ï¼Œé¿å…è¢«ç‹€æ…‹åˆ—æ“‹ä½ */
            padding-top: env(safe-area-inset-top); 
            padding-bottom: 80px; 
            color: var(--color-primary);
            -webkit-tap-highlight-color: transparent;
        }

        /* éš±è—æ©«å‘æ²è»¸ä½†ä¿ç•™æ»‘å‹•åŠŸèƒ½ */
        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .card-shadow {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }
        
        /* åº•éƒ¨å°èˆªåˆ— */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 65px;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(8px);
            border-top: 1px solid var(--color-border);
            z-index: 1000;
            padding-bottom: env(safe-area-inset-bottom);
        }

        /* æ¨™ç±¤æ¨£å¼ */
        .tag-base {
            padding: 3px 10px;
            border-radius: 9999px;
            font-size: 0.7rem;
            font-weight: 600;
        }
        .tag-sight { background-color: #ECFDF5; color: #059669; }
        .tag-gourmet { background-color: #FFFBEB; color: #D97706; }
        .tag-transport { background-color: #EFF6FF; color: #2563EB; }
        .tag-accommodation { background-color: #F3F4F6; color: #4B5563; }
        .tag-alert { background-color: #FEF2F2; color: #EF4444; border: 1px solid #FECACA; }

        /* Timeline */
        .timeline-container {
            position: relative;
            padding-left: 24px;
            margin-left: 8px;
        }
        .timeline-container::before {
            content: '';
            position: absolute;
            left: 7px;
            top: 5px;
            bottom: 0;
            width: 2px;
            background-color: #E5E7EB;
        }
        .timeline-item {
            position: relative;
            padding-bottom: 32px;
            padding-left: 16px;
        }
        .timeline-dot {
            position: absolute;
            left: -21px;
            top: 2px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--color-primary);
            border: 2px solid #F7F8FC;
            box-shadow: 0 0 0 2px #fff;
            z-index: 10;
        }
        .timeline-alert .timeline-dot { background-color: #EF4444; }
        .timeline-item:last-child { padding-bottom: 8px; }

        /* Day Pills Active State */
        .day-pill[data-active='true'] {
            background-color: #1F2937;
            color: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>

<div id="app" class="max-w-xl mx-auto min-h-screen relative">
    
    <!-- Header -->
    <header class="p-6 bg-white/95 backdrop-blur border-b border-gray-100 sticky top-0 z-50 card-shadow">
        <h1 class="text-xl font-bold text-gray-800">æ—¥æœ¬æ±äº¬è¼•äº•æ¾¤ä¸ƒæ—¥æ—…ç¨‹</h1>
        <p class="text-xs text-gray-500 mt-1 flex items-center">
            <i data-lucide="map-pin" class="w-3 h-3 mr-1"></i> 2025/12/3 - 12/9
        </p>
    </header>

    <main class="p-4 sm:p-6 pb-20">
        <!-- Itinerary Tab -->
        <div id="tab-itinerary" class="tab-content active">
            <!-- Day Nav Pills (Sticky & Hide Scrollbar) -->
            <div class="sticky top-[80px] z-40 -mx-4 px-4 bg-gradient-to-b from-[#F7F8FC] via-[#F7F8FC] to-transparent pb-2">
                <div id="day-nav-pills" class="flex overflow-x-auto whitespace-nowrap py-2 space-x-3 hide-scrollbar scroll-smooth">
                    <!-- Buttons generated by JS -->
                </div>
            </div>

            <div id="itinerary-list" class="mt-2">
                <!-- Content generated by JS -->
            </div>
        </div>

        <!-- Tools Tab -->
        <div id="tab-tools" class="tab-content hidden animate-fade-in">
            <h2 class="text-2xl font-bold mb-6 border-l-4 border-gray-800 pl-3 text-gray-800">æ—…éŠå·¥å…·ç®±</h2>
            
            <!-- MUST HAVE Card -->
            <div class="bg-gray-800 text-white p-5 rounded-xl mb-6 card-shadow border-b-4 border-red-500 relative overflow-hidden">
                <div class="relative z-10">
                    <h3 class="text-lg font-bold mb-2 flex items-center text-yellow-400">
                        <i data-lucide="alert-triangle" class="w-5 h-5 mr-2"></i>
                        å…¥å¢ƒé‡è¦è³‡æº
                    </h3>
                    <div class="border-t border-gray-600 pt-3">
                        <p class="text-sm font-medium">Visit Japan Web</p>
                        <p class="text-xs text-gray-400 mt-1">å…¥å¢ƒå¯©æŸ¥ & æµ·é—œç”³å ± (è«‹æˆªåœ– QR Code)</p>
                        <a href="https://www.vjw.digital.go.jp/" target="_blank" class="mt-3 inline-flex items-center bg-white text-gray-900 px-3 py-1.5 rounded-lg text-xs font-bold hover:bg-gray-100 transition">
                            <i data-lucide="external-link" class="w-3 h-3 mr-1"></i> å‰å¾€ VJW
                        </a>
                    </div>
                </div>
            </div>

            <!-- Emergency Card -->
            <div class="bg-white p-5 rounded-xl mb-6 card-shadow">
                <div class="flex items-center text-lg font-bold mb-3 border-b pb-2 text-red-600">
                    <i data-lucide="phone-call" class="w-5 h-5 mr-2"></i>
                    ç·Šæ€¥è¯çµ¡ & æ”¯æ´
                </div>
                <div id="emergency-info" class="text-sm space-y-3"></div>
            </div>
            
            <!-- Flight Info Card -->
            <div class="bg-white p-5 rounded-xl mb-6 card-shadow">
                <div class="flex items-center text-lg font-bold mb-3 border-b pb-2 text-blue-500">
                    <i data-lucide="plane" class="w-5 h-5 mr-2 text-blue-500"></i>
                    èˆªç­è³‡è¨Š
                </div>
                <div id="flight-info" class="text-sm space-y-2"></div>
            </div>

            <!-- Accommodation Card -->
            <div class="bg-white p-5 rounded-xl mb-6 card-shadow">
                <div class="flex items-center text-lg font-bold mb-3 border-b pb-2 text-green-500">
                    <i data-lucide="building" class="w-5 h-5 mr-2 text-green-500"></i>
                    ä½å®¿è³‡è¨Š
                </div>
                <div id="hotel-info" class="text-sm space-y-2"></div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav flex justify-around items-center px-6">
        <button class="nav-btn flex flex-col items-center justify-center w-full h-full text-gray-800 transition-colors active-nav-btn" data-tab="itinerary">
            <i data-lucide="calendar-days" class="w-6 h-6 mb-1"></i>
            <span class="text-[10px] font-bold">è¡Œç¨‹</span>
        </button>
        <button class="nav-btn flex flex-col items-center justify-center w-full h-full text-gray-400 hover:text-gray-600 transition-colors" data-tab="tools">
            <i data-lucide="briefcase" class="w-6 h-6 mb-1"></i>
            <span class="text-[10px] font-medium">å·¥å…·</span>
        </button>
    </nav>
</div>

<script>
    // --- Data ---
    const itineraryData = [
        { day: 1, date: '2025/12/3 (Wed)', dayName: 'è¼•äº•æ¾¤åˆè¦‹ ğŸŒ²', location: 'è¼•äº•æ¾¤', time: '14:20', type: 'transport', title: 'æˆç”°ç©ºæ¸¯2èˆªå»ˆ (NRT)', details: 'ğŸ›¬ æŠµé”æ—¥æœ¬', tags: ['transport'] },
        { day: 1, time: '15:42', type: 'transport', title: 'Skyliner å¾€äº¬æˆä¸Šé‡', location: 'äº¬æˆä¸Šé‡', details: 'âš¡ï¸ äº¤é€šé è¨‚æé†’ï¼šæœªè¨‚ç¥¨ (Â¥2,567)', tags: ['transport', 'alert'], link: 'https://www.keisei.co.jp/keisei/tetudou/skyliner/tc/traffic/skyliner.php' },
        { day: 1, time: '16:58', type: 'transport', title: 'JR æ–°å¹¹ç·š Asama å¾€è¼•äº•æ¾¤', location: 'è¼•äº•æ¾¤è»Šç«™', details: 'ğŸš„ é‡å¤§äº¤é€šï¼šç¾å ´è³¼ç¥¨ (Â¥5,280)', tags: ['transport', 'alert'], link: 'https://ekitan.com/transit/shinkansen/section/sf-1627/st-3467/asama?dt=20251203&hour=' },
        { day: 1, time: '18:18', type: 'accommodation', title: 'Hotel Cypress Karuizawa', location: 'Hotel Cypress Karuizawa', details: 'ğŸš¶ æ­¥è¡Œ 12 åˆ†é˜ (å¯æ­ Taxi)', tags: ['accommodation'] },
        { day: 1, time: '19:00', type: 'gourmet', title: 'DELICIA è¼•äº•æ¾¤åº—', location: 'DELICIA è¼•äº•æ¾¤åº—', details: 'ğŸ›’ æœ‰ä¾¿ç•¶å¯å¾®æ³¢å…§ç”¨', tags: ['gourmet'] },

        { day: 2, date: '2025/12/4 (Thu)', dayName: 'è¼•äº•æ¾¤å†¬æ—¥ç‰©èª â„ï¸', location: 'è¼•äº•æ¾¤', time: '08:30', type: 'transport', title: 'ç”ºå…§å¾ªç’°å·´å£«å¾€ èˆŠè¼•äº•æ¾¤', location: 'èˆŠè¼•äº•æ¾¤', details: 'ğŸšŒ æ–¼é‡æ²¢åŸï¼ˆãƒã‚¹ï¼‰æ­ä¹˜ï¼Œå·´å£«è²»ï¼šÂ¥100ã€‚', tags: ['transport', 'alert'], link: 'https://japantravel.navitime.com/zh-tw/area/jp/railroad/00069997/' }, 
        { day: 2, time: '08:42', type: 'sight', title: 'èˆŠè¼•äº•æ¾¤éŠ€åº§é€š æ¼«æ­¥', location: 'èˆŠè¼•äº•æ¾¤éŠ€åº§é€š', details: 'äº«å—å†¬æ—¥å¯§éœçš„æ—©æ™¨', tags: ['sight'] },
        { day: 2, time: '12:00', type: 'gourmet', title: 'å·ä¸Šåºµè¼•äº•æ¾¤æœ¬åº—', location: 'å·ä¸Šåºµè¼•äº•æ¾¤æœ¬åº—', details: 'ğŸœ è‘—åçš„æ—¥å¼è•éº¥éºµ', tags: ['gourmet'] },
        { day: 2, time: '13:00', type: 'transport', title: 'è¥¿æ­¦å·´å£«å¾€ æ˜Ÿé‡æº«æ³‰', location: 'æ˜Ÿé‡æº«æ³‰', details: 'ğŸšŒ å·´å£«è²»ï¼šÂ¥420', tags: ['transport'] },
        { day: 2, time: '13:26', type: 'sight', title: 'ã‚±ãƒ©æ± ã‚¹ã‚±ãƒ¼ãƒˆãƒªãƒ³ã‚¯ (æºœå†°å ´)', location: 'ã‚±ãƒ©æ± ã‚¹ã‚±ãƒ¼ãƒˆãƒªãƒ³ã‚¯', details: 'â›¸ï¸ é–€ç¥¨: Â¥1,900', tags: ['sight'] },
        { day: 2, time: '15:00', type: 'sight', title: 'çŸ³ä¹‹æ•™æœƒ / è¼•äº•æ¾¤é«˜åŸæ•™æœƒ', location: 'çŸ³ä¹‹æ•™æœƒ', details: 'â›ªï¸ é–‹æ”¾è‡³ 17:00', tags: ['sight'] },
        { day: 2, time: '17:30', type: 'sight', title: 'æ˜Ÿé‡æº«æ³‰ Tonbo-no-yu æ³¡æ¹¯', location: 'æ˜Ÿé‡æº«æ³‰ Tonbo-no-yu', details: 'â™¨ï¸ è²»ç”¨: Â¥1,350', tags: ['sight'] },
        { day: 2, time: '19:00', type: 'gourmet', title: 'æ‘æ°‘é£Ÿå ‚', location: 'æ‘æ°‘é£Ÿå ‚', details: 'å…ˆæŠ½è™Ÿç¢¼ç‰Œ', tags: ['gourmet'] },
        { day: 2, time: '20:00', type: 'sight', title: 'è¼•äº•æ¾¤é«˜åŸæ•™æœƒ è–èª•é»ç‡ˆ', location: 'è¼•äº•æ¾¤é«˜åŸæ•™æœƒ', details: 'âœ¨ éœ€äº‹å…ˆé è¨‚ï¼(æœªè¨‚)', tags: ['sight', 'alert'] },

        { day: 3, date: '2025/12/5 (Fri)', dayName: 'è³¼ç‰©èˆ‡éƒ½æœƒåˆ‡æ› ğŸ™ï¸', location: 'æ±äº¬', time: '09:10', type: 'gourmet', title: 'TruffleBAKERY è¼•äº•æ¾¤åº—', location: 'TruffleBAKERY è¼•äº•æ¾¤åº—', details: 'ğŸ¥ æœ¨æ‘æ‹“å“‰æ¨è–¦ã€Œç™½æ¾éœ²é¹½å¥¶æ²¹æ²ã€', tags: ['gourmet'] },
        { day: 3, time: '10:00', type: 'shopping', title: 'è¼•äº•æ¾¤ç‹å­è³¼ç‰©å»£å ´', location: 'è¼•äº•æ¾¤ç‹å­è³¼ç‰©å»£å ´', details: 'ğŸ›ï¸ é€—ç•™æ™‚é–“åŒ…å«åˆé¤', tags: ['shopping'] },
        { day: 3, time: '15:00', type: 'transport', title: 'JR æ–°å¹¹ç·š Asama å¾€æ±äº¬', location: 'æ±äº¬è»Šç«™', details: 'ğŸš„ äº¤é€šè²»ï¼šÂ¥5,280', tags: ['transport'] },
        { day: 3, time: '16:36', type: 'transport', title: 'åœ°éµå¾€ ç”°åŸç”º', location: 'ç”°åŸç”ºç«™', details: 'ğŸš‡ å‡ºå£ 1 (é›»æ¢¯) æ­¥è¡Œ 4 åˆ†é˜', tags: ['transport'] },
        { day: 3, time: '16:40', type: 'accommodation', title: 'å¤‰ãªãƒ›ãƒ†ãƒ«æ±äº¬æµ…è‰ç”°åŸç”º å…¥ä½', location: 'å¤‰ãªãƒ›ãƒ†ãƒ«æ±äº¬æµ…è‰ç”°åŸç”º', details: 'ä¼‘æ¯ 50 åˆ†é˜', tags: ['accommodation'] },
        { day: 3, time: '18:00', type: 'gourmet', title: 'Spice Cafe ã‚¹ãƒ‘ã‚¤ã‚¹ã‚«ãƒ•ã‚§', location: 'Spice Cafe ã‚¹ãƒ‘ã‚¤ã‚¹ã‚«ãƒ•ã‚§', details: 'ğŸ› è¨ˆç¨‹è»Šå‰å¾€', tags: ['gourmet'] },
        { day: 3, time: '20:00', type: 'sight', title: 'æ±äº¬æ™´ç©ºè¡—é“ / æ™´ç©ºå¡”', location: 'æ±äº¬ã‚¹ã‚«ã‚¤ãƒ„ãƒªãƒ¼', details: 'ğŸ—¼ æŠ¼ä¸Šç«™ A2 å‡ºå£å¾’æ­¥ 2 åˆ†', tags: ['sight'] },

        { day: 4, date: '2025/12/6 (Sat)', dayName: 'æ±Ÿæˆ¶é¢¨æƒ…èˆ‡æ‘©ç™»ä¹‹å¤œ ğŸ®', location: 'æ±äº¬', time: '08:10', type: 'gourmet', title: 'éµœé¶˜éºµåŒ…åº— / KIELO COFFEE', location: 'éµœé¶˜éºµåŒ…åº—ï¼ˆãƒ‘ãƒ³ã®ãƒšãƒªã‚«ãƒ³ï¼‰', details: 'ğŸ é€—ç•™æ™‚é–“ 40 åˆ†é˜', tags: ['gourmet'] },
        { day: 4, time: '09:00', type: 'sight', title: 'æ·ºè‰é›·é–€ / ä»²è¦‹ä¸–å•†åº—è¡—', location: 'æ·ºè‰é›·é–€', details: 'â›©ï¸ æ­¥è¡Œå‰å¾€', tags: ['sight', 'shopping'] },
        { day: 4, time: '10:30', type: 'gourmet', title: 'Leaves Coffee Roasters', location: 'Leaves Coffee Roasters', details: 'â˜•ï¸ æ­è¨ˆç¨‹è»Šå‰å¾€ (ç´„ 10 åˆ†é˜)ã€‚æ—¥æœ¬å† è»å’–å•¡ã€‚', tags: ['gourmet', 'transport'] },
        { day: 4, time: '12:00', type: 'sight', title: 'æ·±å·æ±Ÿæˆ¸è³‡æ–™é¤¨ / é’è‘‰å ‚', location: 'æ·±å·æ±Ÿæˆ¸è³‡æ–™é¤¨', details: 'ğŸ˜ï¸ é™„è¿‘åˆé¤', tags: ['sight', 'shopping'] },
        { day: 4, time: '14:00', type: 'gourmet', title: 'æ¸…æ¾„ç™½æ²³å’–å•¡è¡—å€', location: 'æ¸…æ¾„ç™½æ²³', details: 'â˜•ï¸ Blue Bottle / Allpress / Arise', tags: ['gourmet'] },
        { day: 4, time: '16:54', type: 'gourmet', title: 'Bricolage bread æˆ– TsuruTonTan', location: 'Bricolage bread & co.', details: 'ğŸ½ï¸ å…­æœ¬æœ¨æ™šé¤', tags: ['gourmet'] },
        { day: 4, time: '19:00', type: 'sight', title: 'èŠå…¬åœ’è€¶èª•å¸‚é›†', location: 'èŠå…¬åœ’', details: 'âœ¨ æ„Ÿå—å¾·åœ‹è€¶èª•æ°›åœ', tags: ['sight'] },
        { day: 4, time: '20:51', type: 'sight', title: 'æ±äº¬éµå¡”', location: 'æ±äº¬ã‚¿ãƒ¯ãƒ¼', details: 'ğŸ—¼ å¯ç¶²è·¯è³¼ç¥¨ (Â¥3,500)', tags: ['sight', 'alert'] },

        { day: 5, date: '2025/12/7 (Sun)', dayName: 'ç¯‰åœ°èˆ‡éŠ€åº§æ™‚å°šå·¡ç¦® ğŸ£', location: 'æ±äº¬', time: '08:45', type: 'gourmet', title: 'ç¯‰åœ°å ´å¤–å¸‚å ´', location: 'ç¯‰åœ°å ´å¤–å¸‚å ´', details: 'ğŸŸ æµ·é®®ç‡’ / ç‰å­ç‡’', tags: ['gourmet'] },
        { day: 5, time: '10:30', type: 'gourmet', title: 'Glitch Coffee (éŠ€åº§)', location: 'GLITCH COFFEE GINZA', details: 'â˜•ï¸ é–‹å§‹éŠ€åº§è¡Œç¨‹', tags: ['gourmet'] },
        { day: 5, time: '11:30', type: 'sight', title: 'éŠ€åº§ä¸‰è¶Š / GINZA SIX', location: 'éŠ€åº§ä¸‰è¶Š', details: 'ğŸ›ï¸ ç²¾å“èˆ‡æ™‚å°šç™¾è²¨è³¼ç‰©', tags: ['shopping'] },
        { day: 5, time: '13:00', type: 'gourmet', title: 'åˆé¤ç¾é£Ÿèˆ‡ç”œé»å·¡ç¦®', location: 'éŠ€åº§', details: 'ğŸœ çƒ¤é£›é­šé¹½å‘³æ‹‰éºµ é«˜æ©‹ / ã‚·ãƒ…ã‚«æ´‹è“å­åº—', tags: ['gourmet', 'shopping'] },
        { day: 5, time: '14:30', type: 'sight', title: 'MUJI / LOFT / ä¼Šæ±å±‹', location: 'ç„¡å°è‰¯å“ éŠ€åº§', details: 'ğŸ“– ç”Ÿæ´»è¨­è¨ˆèˆ‡æ–‡å…·è³¼ç‰©', tags: ['shopping'] },
        { day: 5, time: '17:30', type: 'gourmet', title: 'æ™šé¤ï¼šéŠ€åº§å‘¨é‚Šè‡ªç”±é¸æ“‡', location: 'éŠ€åº§', details: 'ğŸ½ï¸ è€ƒæ…®å±…é…’å±‹æˆ–ç‰¹è‰²æ–™ç†', tags: ['gourmet'] },
        { day: 5, time: '19:00', type: 'shopping', title: 'æ±äº¬ä¸€ç•ªè¡— / KITTE ä¸¸ä¹‹å…§', location: 'æ±äº¬è»Šç«™', details: 'ğŸ›ï¸ åœ°ä¸‹è¡—ä¼´æ‰‹ç¦®ã€‚KITTEå¯çœ‹å¤œæ™¯ã€‚', tags: ['shopping', 'sight'] },
        { day: 5, time: '21:00', type: 'shopping', title: 'å”å‰è¨¶å¾· æ·ºè‰åº— (24hr)', location: 'ãƒ‰ãƒ³ãƒ»ã‚­ãƒ›ãƒ¼ãƒ† æµ…è‰åº—', details: 'ğŸ›’ æœ€å¾Œæ¡è³¼ã€‚ã¤ãã°EXæµ…è‰é§…å¾’æ­©1åˆ†ã€‚', tags: ['shopping'] },

        { day: 6, date: '2025/12/8 (Mon)', dayName: 'éŠ€æç¾æ™¯èˆ‡æ½®æµæ¢ç´¢ ğŸ‚', location: 'æ±äº¬', time: '08:40', type: 'gourmet', title: 'No.4', location: 'No.4', details: 'ğŸ æ±äº¬å¿…åƒæ—©åˆé¤ååº—', tags: ['gourmet'] },
        { day: 6, time: '10:41', type: 'sight', title: 'ç¥å®®å¤–è‹‘éŠ€æ æˆ– æ±å¤§éŠ€æ', location: 'æ˜æ²»ç¥å®®å¤–è‹‘', details: 'ğŸ å°‹æ‰¾ç§‹å†¬é™å®šç¾æ™¯', tags: ['sight'] },
        { day: 6, time: '12:11', type: 'gourmet', title: 'MARION CREPES / I\'m donut', location: 'åŸå®¿', details: 'ğŸ© å›æ†¶ç¾é£Ÿ/ç”œç”œåœˆ', tags: ['gourmet'] },
        { day: 6, time: '12:40', type: 'gourmet', title: 'Luke\'s Lobster è¡¨åƒé“åº—', location: 'è¡¨åƒé“', details: 'ğŸ¦ äººæ°£é¾è¦å ¡', tags: ['gourmet'] },
        { day: 6, time: '13:40', type: 'shopping', title: 'è¡¨åƒé“ / NUMBER SUGAR', location: 'NUMBER SUGAR', details: 'ğŸ›ï¸ æ½®æµèˆ‡è¨­è¨ˆå°ç‰©ã€ç‰›å¥¶ç³–', tags: ['shopping'] },
        { day: 6, time: '15:45', type: 'sight', title: 'Shibuya SKY', location: 'Shibuya SKY', details: 'ğŸŒ† å·²é è¨‚! 16:20-16:39 å…¥å ´ï¼Œæ¬£è³æ—¥è½', tags: ['sight', 'alert'] },
        { day: 6, time: '19:00', type: 'sight', title: 'AFURIæ‹‰éºµ', location: 'AFURI æ¸‹è°·é“ç„å‚', details: 'ğŸœ æ™šé¤åƒæŸšå­æ‹‰éºµ', tags: ['gourmet'] },
        { day: 6, time: '19:49', type: 'shopping', title: 'BicCamera / æ¾æœ¬æ¸…', location: 'æ–°å®¿æ±å£', details: 'ğŸ›’ æ–°å®¿æ±å£ï¼Œæ™šä¸Šç›¡æƒ…è³¼ç‰©', tags: ['shopping'] },

        { day: 7, date: '2025/12/9 (Tue)', dayName: 'å‘Šåˆ¥æ±äº¬ ğŸ‘‹', location: 'æ±äº¬', time: '08:30', type: 'accommodation', title: 'é€€æˆ¿', location: 'å¤‰ãªãƒ›ãƒ†ãƒ«æ±äº¬æµ…è‰ç”°åŸç”º', details: 'ğŸš¶ æ­¥è¡Œ 4 åˆ†é˜', tags: ['accommodation'] },
        { day: 7, time: '08:45', type: 'transport', title: 'äº¬æˆä¸Šé‡ç«™ æ‰‹è·ç‰©æ«ƒå°', location: 'äº¬æˆä¸Šé‡ç«™', details: 'ğŸ’¼ å¯„æ”¾è¡Œæ (Â¥800)', tags: ['transport'], link: 'https://miha.tw/baggage-ueno/' },
        { day: 7, time: '09:00', type: 'shopping', title: 'é˜¿ç¾æ©«ç”º', location: 'é˜¿ç¾æ©«ç”º', details: 'ğŸ æœ€å¾Œè£œè²¨ (äºŒæœ¨è“å­/UNIQLO)', tags: ['shopping'] },
        { day: 7, time: '12:20', type: 'transport', title: 'äº¬æˆ Skyliner å¾€ æˆç”°ç©ºæ¸¯', location: 'æˆç”°åœ‹éš›æ©Ÿå ´', details: 'ğŸš„ äº¤é€šé è¨‚æé†’ï¼šæœªè¨‚ç¥¨', tags: ['transport', 'alert'], link: 'https://www.keisei.co.jp/keisei/tetudou/skyliner/tc/traffic/skyliner.php' },
        { day: 7, time: '15:40', type: 'transport', title: 'æˆç”°ç©ºæ¸¯ (NRT)', location: 'æˆç”°åœ‹éš›æ©Ÿå ´', details: 'ğŸ›« èˆªç­ JX803', tags: ['transport'] },
        { day: 7, time: '18:45', type: 'transport', title: 'å°åŒ— (TPE)', location: 'æ¡ƒåœ’åœ‹éš›æ©Ÿå ´', details: 'ğŸ‡¹ğŸ‡¼ æ—…é€”æ„‰å¿«ï¼', tags: ['transport'] },
    ];

    const toolData = {
        flight: [
            { label: 'å»ç¨‹', value: 'JX801 (11:30 TPE â†’ 14:20 NRT)' },
            { label: 'å›ç¨‹', value: 'JX803 (15:40 NRT â†’ 18:45 TPE)' },
            { label: 'èˆªç©ºå…¬å¸', value: 'æ˜Ÿå®‡èˆªç©º Starlux' },
        ],
        hotel: [
            { label: 'è¼•äº•æ¾¤ (12/3-5)', value: 'Hotel Cypress Karuizawa' },
            { label: 'æ±äº¬ (12/5-9)', value: 'å¤‰ãªãƒ›ãƒ†ãƒ«æ±äº¬æµ…è‰ç”°åŸç”º' },
        ],
        emergency: [
            { label: 'ç•¶åœ°å ±è­¦ (Police)', value: '110', class: 'text-2xl font-black text-red-700' },
            { label: 'ç•¶åœ°æ•‘è­· (Ambulance)', value: '119', class: 'text-2xl font-black text-red-700' },
            { label: 'é†«ç™‚æ€¥é›£ç†±ç·š (JNTO)', value: '050-3816-2787', class: 'text-lg font-bold text-gray-800' },
            { label: 'å°ç£é§æ—¥ä»£è¡¨è™•', value: '+81-3-3280-7800', class: 'text-sm font-medium text-blue-600' },
        ],
    };

    const dayImageMap = {
        1: 'https://placehold.co/800x200/507d6c/507d6c',
        2: 'https://placehold.co/800x200/7a9998/7a9998',
        3: 'https://placehold.co/800x200/5a6797/5a6797',
        4: 'https://placehold.co/800x200/3e4c6c/3e4c6c',
        5: 'https://placehold.co/800x200/535453/535453',
        6: 'https://placehold.co/800x200/8d6263/8d6263',
        7: 'https://placehold.co/800x200/3e3e3e/3e3e3e',
    };

    // --- Logic ---

    function mockWeather(dayName) {
        const location = dayName.includes('è¼•äº•æ¾¤') ? 'è¼•äº•æ¾¤' : 'æ±äº¬';
        // ç°¡æ˜“æ¨¡æ“¬
        if (location === 'è¼•äº•æ¾¤') {
            return { hourly: [{time:'08:00',icon:'â˜€ï¸',temp:'2Â°'}, {time:'12:00',icon:'â›…',temp:'7Â°'}, {time:'16:00',icon:'â„ï¸',temp:'3Â°'}, {time:'20:00',icon:'â˜ƒï¸',temp:'0Â°'}] };
        }
        return { hourly: [{time:'08:00',icon:'â˜€ï¸',temp:'8Â°'}, {time:'12:00',icon:'â˜€ï¸',temp:'14Â°'}, {time:'16:00',icon:'â˜ï¸',temp:'11Â°'}, {time:'20:00',icon:'ğŸŒ™',temp:'9Â°'}] };
    }

    function renderItineraryItem(item) {
        const typeClasses = { 'sight': 'tag-sight', 'gourmet': 'tag-gourmet', 'transport': 'tag-transport', 'accommodation': 'tag-accommodation', 'shopping': 'tag-sight' };
        const typeClassName = typeClasses[item.type] || 'tag-base';
        const isAlert = item.tags.includes('alert');
        const alertClass = isAlert ? 'timeline-alert' : '';

        const mapButton = item.location && item.type !== 'transport' ? 
            `<button onclick="handleMapClick('${item.location}')" class="flex items-center text-blue-600 text-xs font-medium hover:text-blue-800 transition bg-blue-50 px-2 py-1 rounded-md">
                <i data-lucide="map-pin" class="w-3 h-3 mr-1"></i> åœ°åœ–
            </button>` : '';

        const linkButton = item.link ? 
            `<a href="${item.link}" target="_blank" class="flex items-center text-red-600 text-xs font-medium hover:text-red-800 transition bg-red-50 px-2 py-1 rounded-md ${mapButton ? 'ml-2' : ''}">
                <i data-lucide="external-link" class="w-3 h-3 mr-1"></i> é è¨‚
            </a>` : '';
        
        return `
            <div id="item-${item.day}-${item.time.replace(':', '')}" class="timeline-item ${alertClass}">
                <div class="timeline-dot"></div>
                <div class="flex items-start justify-between">
                    <div class="flex flex-col flex-grow pr-2">
                        <span class="text-xs font-mono font-medium text-gray-400 mb-0.5">${item.time}</span>
                        <h4 class="text-base font-bold text-gray-800">${item.title}</h4>
                    </div>
                    <div class="flex items-center flex-shrink-0 mt-1">
                        ${mapButton} ${linkButton}
                    </div>
                </div>
                <p class="text-sm text-gray-600 mt-1 mb-2 leading-relaxed">${item.details}</p>
                <span class="${typeClassName} tag-base inline-block">${item.type === 'shopping' ? 'è³¼ç‰©' : item.type === 'gourmet' ? 'ç¾é£Ÿ' : item.type === 'transport' ? 'äº¤é€š' : item.type === 'accommodation' ? 'ä½å®¿' : 'æ™¯é»'}</span>
            </div>
        `;
    }

    function renderDailyItinerary(dayNumber, date, dayName, items) {
        const weather = mockWeather(dayName);
        const bannerUrl = dayImageMap[dayNumber] || dayImageMap[3]; 
        const location = dayName.includes('è¼•äº•æ¾¤') ? 'è¼•äº•æ¾¤' : 'æ±äº¬';

        const hourlyHtml = weather.hourly.map(h => `
            <div class="flex flex-col items-center text-xs text-gray-600">
                <span class="font-medium mb-1">${h.time}</span>
                <span class="text-lg mb-1">${h.icon}</span>
                <span class="font-bold">${h.temp}</span>
            </div>
        `).join('');

        return `
            <section id="day-${dayNumber}-section" class="daily-section hidden mb-8 animate-fade-in">
                <!-- Banner -->
                <div class="h-44 rounded-xl overflow-hidden mb-5 relative card-shadow group">
                    <img src="${bannerUrl}" alt="${dayName}" class="w-full h-full object-cover transition duration-700 group-hover:scale-110">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent flex flex-col justify-end p-5 text-white">
                        <p class="text-xs font-bold uppercase tracking-wider opacity-80 mb-1">Day ${dayNumber} â€¢ ${date.split(' ')[0]}</p>
                        <h3 class="text-2xl font-black">${dayName.split(' ')[0]}</h3>
                    </div>
                </div>

                <!-- Weather -->
                <div class="bg-white p-4 rounded-xl mb-5 card-shadow border border-gray-100">
                    <div class="flex justify-between items-center text-xs font-bold text-gray-400 uppercase tracking-wide border-b border-gray-100 pb-2 mb-3">
                        <span><i data-lucide="cloud-sun" class="w-3 h-3 inline mr-1"></i> ${location} Weather</span>
                        <span>Today's Forecast</span>
                    </div>
                    <div class="flex justify-between px-2">
                        ${hourlyHtml}
                    </div>
                </div>

                <div class="timeline-container">
                    ${items.map(renderItineraryItem).join('')}
                </div>
            </section>
        `;
    }

    function renderItinerary() {
        const listContainer = document.getElementById('itinerary-list');
        const navContainer = document.getElementById('day-nav-pills');
        listContainer.innerHTML = '';
        navContainer.innerHTML = '';

        const groupedData = itineraryData.reduce((acc, item) => {
            if (!acc[item.day]) acc[item.day] = [];
            acc[item.day].push(item);
            return acc;
        }, {});

        Object.keys(groupedData).forEach(day => {
            const dayNumber = parseInt(day);
            const dayItems = groupedData[dayNumber];
            listContainer.innerHTML += renderDailyItinerary(dayNumber, dayItems[0].date, dayItems[0].dayName, dayItems);

            const dayOfWeek = dayItems[0].date.match(/\((.*?)\)/)[1];
            navContainer.innerHTML += `
                <button onclick="showDay(${dayNumber})" 
                        class="day-pill flex-shrink-0 text-center transition-all duration-200 p-2 rounded-xl w-14 h-16 border border-gray-200 bg-white 
                        data-[active='true']:scale-105 data-[active='true']:border-gray-800" 
                        data-day="${dayNumber}">
                    <span class="text-[10px] font-bold text-gray-400 block mb-1 uppercase">${dayOfWeek}</span>
                    <span class="block text-xl font-black text-gray-800 leading-none">${dayNumber}</span>
                </button>
            `;
        });
    }

    function renderTools() {
        // Render flight and hotel info (Simplified for brevity)
        const renderList = (data) => data.map(d => 
            `<div class="flex justify-between border-b border-dashed border-gray-200 py-2 last:border-0 text-xs sm:text-sm">
                <span class="text-gray-500">${d.label}</span>
                <span class="text-gray-800 font-bold text-right">${d.value}</span>
            </div>`
        ).join('');
        
        document.getElementById('flight-info').innerHTML = renderList(toolData.flight);
        document.getElementById('hotel-info').innerHTML = renderList(toolData.hotel);

        document.getElementById('emergency-info').innerHTML = `
            <div class="grid grid-cols-2 gap-3 mb-3">
                <div class="bg-red-50 p-3 rounded-lg text-center border border-red-100">
                    <p class="text-[10px] font-bold text-red-400 mb-1">POLICE</p>
                    <p class="${toolData.emergency[0].class}">${toolData.emergency[0].value}</p>
                </div>
                <div class="bg-red-50 p-3 rounded-lg text-center border border-red-100">
                    <p class="text-[10px] font-bold text-red-400 mb-1">AMBULANCE</p>
                    <p class="${toolData.emergency[1].class}">${toolData.emergency[1].value}</p>
                </div>
            </div>
            <div class="bg-gray-50 p-3 rounded-lg border border-gray-200 flex justify-between items-center">
                <span class="text-xs font-bold text-gray-500">é†«ç™‚ç†±ç·š</span>
                <a href="tel:${toolData.emergency[2].value}" class="text-lg font-bold text-gray-800">${toolData.emergency[2].value}</a>
            </div>
        `;
    }

    // --- Actions ---

    function showTab(tabName) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.add('hidden');
            tab.classList.remove('active');
        });
        document.getElementById(`tab-${tabName}`).classList.remove('hidden');
        document.getElementById(`tab-${tabName}`).classList.add('active');

        document.querySelectorAll('.nav-btn').forEach(btn => {
            const isActive = btn.dataset.tab === tabName;
            if (isActive) {
                btn.classList.add('text-gray-900', 'active-nav-btn');
                btn.classList.remove('text-gray-400');
            } else {
                btn.classList.remove('text-gray-900', 'active-nav-btn');
                btn.classList.add('text-gray-400');
            }
        });

        if (tabName === 'itinerary') {
            const activeDay = document.querySelector('.day-pill[data-active="true"]')?.dataset.day || 1;
            showDay(parseInt(activeDay));
        } else {
            // Re-render icons when switching to tools
            setTimeout(() => lucide.createIcons(), 50);
        }
    }

    function showDay(dayNumber) {
        document.querySelectorAll('.daily-section').forEach(section => section.classList.add('hidden'));
        const target = document.getElementById(`day-${dayNumber}-section`);
        if(target) target.classList.remove('hidden');

        document.querySelectorAll('.day-pill').forEach(pill => {
            const isActive = parseInt(pill.dataset.day) === dayNumber;
            pill.setAttribute('data-active', isActive);
            if (isActive) {
                pill.scrollIntoView({ behavior: 'smooth', inline: 'center' });
            }
        });
        
        // ç¢ºä¿åœ–æ¨™æ­£ç¢ºé¡¯ç¤º
        lucide.createIcons();
    }

    function handleMapClick(location) {
        window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(location + ', æ—¥æœ¬')}`, '_blank');
    }

    // --- Init ---
    document.addEventListener('DOMContentLoaded', () => {
        renderItinerary();
        renderTools();
        
        // çµ±ä¸€åˆå§‹åŒ–ä¸€æ¬¡å³å¯
        lucide.createIcons();

        showDay(1);
        
        document.querySelectorAll('.nav-btn').forEach(btn => {
            btn.addEventListener('click', (e) => showTab(e.currentTarget.dataset.tab));
        });
        
        showTab('itinerary');
    });

</script>

</body>
</html>
